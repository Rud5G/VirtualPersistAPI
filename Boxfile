db1:
    name: symfony_db
    type: mysql

web1:
    name: symfony_web
    shared_writable_dirs:
     - symfony/app/cache
     - symfony/app/cache/prod
     - symfony/app/logs
     - symfony/app/sessions

    document_root: symfony/web
    default_gateway: app.php
    index_list: [app.php]

    php_version: 5.3.10
    php_extensions:
     - apc
     - intl
     - mbstring
     - xsl
     - mysql
     - pdo_mysql
     - zip

    php_short_open_tag: "0"
    php_magic_quotes_gpc: "0"
    php_register_globals: "0"
    php_session_autostart: "0"
    php_date_timezone: America/Detroit

    after_build:
        - 'curl -s https://getcomposer.org/installer | php -- --install-dir="symfony" --quiet'
        - 'php symfony/composer.phar install -d="symfony" --no-progress'
        - "php symfony/app/console --env=prod --no-debug assetic:dump -n"
        - "echo 'parameters:' >> symfony/app/config/parameters.yml"
        - "echo ' database_driver: pdo_mysql' >> symfony/app/config/parameters.yml"
        - "echo ' database_host: ' $DB1_HOST >> symfony/app/config/parameters.yml"
        - "echo ' database_port: 3306' >> symfony/app/config/parameters.yml"
        - "echo ' database_name: ' $DB1_NAME >> symfony/app/config/parameters.yml"
        - "echo ' database_user: ' $DB1_USER >> symfony/app/config/parameters.yml"
        - "echo ' database_password: ' $DB1_PASS >> symfony/app/config/parameters.yml"
        - "echo ' mailer_transport: smtp' >> symfony/app/config/parameters.yml"
        - "echo ' mailer_host: localhost' >> symfony/app/config/parameters.yml"
        - "echo ' mailer_user: ~' >> symfony/app/config/parameters.yml"
        - "echo ' mailer_password: ~' >> symfony/app/config/parameters.yml"
        - "echo ' locale: en' >> symfony/app/config/parameters.yml"
        - "echo ' secret: ThisTokenIsNotSoSecretChangeIt' >> symfony/app/config/parameters.yml"

    before_deploy:
        - "php symfony/app/console --env=prod --no-debug cache:clear --no-warmup"
        - "php symfony/app/console --env=prod --no-debug cache:warmup"
        - "php symfony/app/console assetic:dump --env=prod"
        - "php symfony/app/console --env=prod --no-debug doctrine:schema:update --force"
#        - "php symfony/app/console --env=prod --no-debug doctrine:migrations:migrate -n"

global:
    env:
        - USE_INTL_ICU_DATA_VERSION: true

