db1:
    name: symfony_db
    type: mysql

web1:
    name: symfony_web
    shared_writable_dirs:
     - app/cache
     - app/logs
     - app/sessions

    document_root: symfony/web
    default_gateway: app_dev.php
    index_list: [app_dev.php]

    php_version: 5.3.10
    php_extensions:
     - apc
     - intl
     - mbstring
     - xsl
     - mysql
     - pdo_mysql
     - zip

    php_short_open_tag: "0"
    php_magic_quotes_gpc: "0"
    php_register_globals: "0"
    php_session_autostart: "0"
    php_date_timezone: America/Detroit

    after_build:
        - 'curl -s https://getcomposer.org/installer | php -- --install-dir="symfony" --quiet'
        - 'php symfony/composer.phar install -d="symfony" --no-progress'
        - "php symfony/app/console --env=prod --no-debug assetic:dump -n"
        - "rm symfony/app/config/parameters.yml"
        - "echo 'parameters:' >> symfony/app/config/parameters.yml"
        - "echo ' database_driver: pdo_mysql' >> symfony/app/config/parameters.yml"
        - "echo ' database_host: %database.host%' >> symfony/app/config/parameters.yml"
        - "echo ' database_port: 3306' >> symfony/app/config/parameters.yml"
        - "echo ' database_name: %database.name%' >> symfony/app/config/parameters.yml"
        - "echo ' database_user: %database.user%' >> symfony/app/config/parameters.yml"
        - "echo ' database_password: %database.password%' >> symfony/app/config/parameters.yml"
        - "echo ' mailer_transport: smtp' >> symfony/app/config/parameters.yml"
        - "echo ' mailer_host: localhost' >> symfony/app/config/parameters.yml"
        - "echo ' mailer_user: ~' >> symfony/app/config/parameters.yml"
        - "echo ' mailer_password: ~' >> symfony/app/config/parameters.yml"
        - "echo ' locale: en' >> symfony/app/config/parameters.yml"
        - "echo ' secret: [secret]' >> symfony/app/config/parameters.yml"

#        - "php vendor/symfony/symfony/src/Symfony/Component/Locale/Resources/data/build-data.php"

    before_deploy:
        - "php symfony/app/console --env=prod --no-debug cache:clear --no-warmup"
        - "php symfony/app/console --env=prod --no-debug cache:warmup"
        - "php symfony/app/console --env=prod --no-debug doctrine:schema:create --force"
        - "php symfony/app/console --env=prod --no-debug doctrine:migrations:migrate -n"

global:
    env:
        - USE_INTL_ICU_DATA_VERSION: true

